options:
    env:
        - BRANCH_NAME=$BRANCH_NAME
steps:
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args: ['-c', 'echo $_DOCKER_PASSWORD | docker login --username eelis --password-stdin']

  - name: 'gcr.io/cloud-builders/docker'
    dir: "backend/tests"
    args: ["compose", "-f", "docker-compose.cloudbuild.yml", "run", "--quiet-pull", backend-$BRANCH_NAME", "-m", "unittest"]

  - name: 'gcr.io/cloud-builders/docker'
    dir: "backend/tests"
    args: ["compose", "-f", "docker-compose.cloudbuild.yml", "down"]


timeout: 3600s
