steps:
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args: ['-c', 'echo $_DOCKER_PASSWORD | docker login --username eelis --password-stdin']

  - name: 'gcr.io/cloud-builders/docker'
    id: "up"
    dir: "backend/tests"
    args: ["compose", "up", "--detach"]

  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: "bash"
    id: "up-completed"
    args: ["-c", "sleep 5"]

  - name: 'gcr.io/cloud-builders/docker'
    dir: "backend/tests"
    args: ["compose", "run", "backend", "-m", "unittest"]
    waitFor: "up-completed"

  - name: 'gcr.io/cloud-builders/docker'
    dir: "backend/tests"
    args: ["compose", "down"]


timeout: 3600s
