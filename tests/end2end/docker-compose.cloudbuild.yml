version: "3"
services:
    backend:
        network_mode: "host"
        image: gcr.io/worpdress-279321/backend-$BRANCH_NAME:latest
        env_file: ../../common/env/$VIDEOSDB_CONFIG.txt
        depends_on:
            - firestore-emulator
            - json-caching-proxy
        environment:
            - DEBUG=1
            - GOOGLE_CLOUD_PROJECT=$FIREBASE_PROJECT
            - LOGLEVEL=DEBUG
            - YOUTUBE_API_URL=http://127.0.0.1:43783/youtube/v3
            - PYTHONDEVMODE=1
            - FIRESTORE_EMULATOR_HOST=127.0.0.1:8080
            - YOUTUBE_API_KEY=AIzaSyB4ssPNsGaIpFv8GNiBl-MbRWzRbuYV-MM

    firestore-emulator:
        network_mode: "host"
        image: spine3/firebase-emulator
        environment:
            - GCP_PROJECT=$FIREBASE_PROJECT
        ports:
            - 8080:8080

    frontend:
        network_mode: "host"
        image: gcr.io/worpdress-279321/frontend-$BRANCH_NAME:latest
        env_file: ../../common/env/$VIDEOSDB_CONFIG.txt
        environment:
            - DEBUG=1
            - NODE_OPTIONS=--openssl-legacy-provider
            - FIRESTORE_EMULATOR_HOST=127.0.0.1:8080
        depends_on:
            - firestore-emulator

    json-caching-proxy:
        network_mode: "host"
        image: gcr.io/worpdress-279321/json-caching-proxy:latest
        ports:
            - 43783:43783
        stop_signal: SIGKILL
