version: "3"
services:
    backend:
        network_mode: "host"
        image: backend
        build:
            context: ../../backend
        env_file: ../../common/env/sadhguru.txt
        depends_on:
            - json-caching-proxy
            - firestore-emulator
        environment:
            - DEBUG=1
            - PYTHONDEVMODE=1
            - PYTHONASYNCIODEBUG=1
            - FIRESTORE_EMULATOR_HOST=localhost:6001
            - YOUTUBE_API_KEY=AIzaSyDM-rEutI1Mr6_b1Uz8tofj2dDlwcOzkjs
            - YOUTUBE_API_URL=http://localhost:8080/youtube/v3
            - LOGLEVEL=DEBUG
            - GOOGLE_CLOUD_PROJECT=videosdb-firebase

    frontend:
        network_mode: "host"
        image: frontend
        env_file: ../../common/env/sadhguru.txt
        environment:
            - FIRESTORE_EMULATOR_HOST=localhost:6001
            - NODE_OPTIONS=--openssl-legacy-provider
        build:
            context: ../../frontend
        depends_on:
            - firestore-emulator
        entrypoint: yarn

    json-caching-proxy:
        network_mode: "host"
        image: json-caching-proxy
        build:
            context: utils/json-caching-proxy
        ports:
            - 6001:6001
        stop_signal: SIGKILL

    firestore-emulator:
        network_mode: "host"
        image: mtlynch/firestore-emulator
        environment:
            - FIRESTORE_PROJECT_ID=videosdb-firebase
            - PORT=6001
        volumes:
            - emulator-data:/root
        ports:
            - 6001:6001

volumes:
    emulator-data:
        name: emulator-data
