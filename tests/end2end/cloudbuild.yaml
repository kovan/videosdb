steps:
  - name: docker/compose
    dir: tests/end2end
    env:
      - REPO=gcr.io/worpdress-279321/
    args:
      - build
  - name: docker/compose
    dir: tests/end2end
    env:
      - REPO=gcr.io/worpdress-279321/
    args:
      - up
      - '-d'
  - name: docker/compose
    dir: tests/end2end
    env:
      - REPO=gcr.io/worpdress-279321/
    args:
      - run
      - backend
      - poetry
      - run
      - python
      - '-m'
      - videosdb
      - '--check-for-new-videos'
      - '--exclude-transcripts'
  - name: docker/compose
    dir: tests/end2end
    env:
      - REPO=gcr.io/worpdress-279321/
    args:
      - run
      - frontend
      - yarn
      - generate

timeout: 3600s
images: 
  - gcr.io/worpdress-279321/json-caching-proxy
  - gcr.io/worpdress-279321/firestore-emulator
  - gcr.io/worpdress-279321/frontend
  - gcr.io/worpdress-279321/backend