<template lang="pug">
  div
    section.jumbotron.text-center
      .container
        h1 Album example
        p.lead.text-muted
          | Something short and leading about the collection below—its contents, the creator, etc. Make it short and sweet, but not too short so folks don’t simply skip over it entirely.
        p
          a.btn.btn-primary.my-2(href="#") Main call to action
          a.btn.btn-secondary.my-2(href="#") Secondary action
    .album.py-5.bg-light
      .container
        .row
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins
          .col-md-4
            .card.mb-4.shadow-sm
              svg.bd-placeholder-img.card-img-top(width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveaspectratio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail")
                title Placeholder
                rect(width="100%" height="100%" fill="#55595c")
                text(x="50%" y="50%" fill="#eceeef" dy=".3em") Thumbnail
              .card-body
                p.card-text
                  | This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.
                .d-flex.justify-content-between.align-items-center
                  .btn-group
                    button.btn.btn-sm.btn-outline-secondary(type="button") View
                    button.btn.btn-sm.btn-outline-secondary(type="button") Edit
                  small.text-muted 9 mins


</template>

<script>
export default {
  data: () => {
    return {
      page_count: 0,
      current_page: 1,
      videos: [],
      period_options: [
        "this week",
        "this month",
        "this year",
        "always"
      ],
      period: "always",
      ordering_options: [
        {
          text: "Latest",
          value: "-yt_published_date"
        },
        {
          text: "Most viewed",
          value: "-view_count"
        },
        {
          text: "Most liked",
          value: "-like_count"
        },
        {
          text: "Most commented",
          value: "-comment_count"
        },
        {
          text: "Most favorited",
          value: "-favorite_count"
        }
      ]
    }
  },
  props: {
    search: "",

    ordering: {
      default: '',
      type: String,
    },
    categories: {
      default: ''
    },
    tags: {
      default: ''
    },
  },
  
  updated () {
    this.$fetch()
  },
  methods: {

    handlePageChange () {
      this.$router.push({
        path: this.$route.path,
        query: {
          page: this.current_page
        }
      })
    },
    handleSearch() {
      this.$fetch()
    },
    handleOrderingChange (args) {
      this.ordering = args
      this.$fetch()
    },
    handlePeriodChange (args) {
      this.period = args
      this.$fetch()
    }    
  },
  async fetch () {


    const dummy_root = "http://example.com"  // otherwise URL doesn't work
    const url = new URL('/api/videos/', dummy_root)
    if (this.ordering)
      url.searchParams.append("ordering", this.ordering)
    if (this.current_page)
      url.searchParams.append("page", this.current_page)
    if (this.categories)
      url.searchParams.append("categories", this.categories)
    if (this.tags)
      url.searchParams.append("tags", this.tags)
    if (this.search)
      url.searchParams.append("search", this.search)

    try {
      let response = await this.$axios.$get(url.href.replace(dummy_root, ""))
      this.videos = response.results
      this.page_count = Math.floor(response.count / response.results.length)

    } catch (error) {
      console.error(error)
    }

  },
}
</script>


<style>



</style>